# included by tests scripts

test_result() {
  set +x
  if [ $1 != 0 ]; then
    echo "\n  --:Test failure:--"
    exit $1
  fi

  echo "  -:Test passed:-"
  set -x
}

test_result_want_fail() {
  set +x
  if [ $1 = 0 ]; then
    echo "\n  --:Test failure:--"
    exit $1
  fi

  echo "  -:Test passed:-"
  set -x
}

#
# HOME is defined in test/Makefile as "tmp-home". But...
# Don't use the var $HOME here, just in case something went wrong somewhere ;)
#
if [ -e rmw-tests-home ]; then
  rm -rf rmw-tests-home
fi

RMW_TEST_CMD_STRING="$BIN_DIR/rmw -c $CONFIG"

if [ "$VALGRIND" = "on" ]; then
  if [ -z `which valgrind` ]; then
    echo "Valgrind isn't installed"
    exit 1
  fi
  VALGRIND=`which valgrind`
  RMW_TEST_CMD_STRING="$VALGRIND --leak-check=full --show-leak-kinds=all --error-exitcode=1 $RMW_TEST_CMD_STRING"
fi

RMW_ALT_TEST_CMD_STRING="$BIN_DIR/rmw -c $ALT_CONFIG"
RMW_PURGE_DISABLED_CMD="$BIN_DIR/rmw -c $PURGE_DISABLED_CONFIG"
SEPARATOR="\n\n--- "
